-- Eschaton UI Library
-- Version: 3.2

local UILibrary = {}

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

-- Глобальные переменные
_G.UIElements = _G.UIElements or {}
_G.UICallbacks = _G.UICallbacks or {}

-- Функции сохранения/загрузки
local function saveSettings(fileName, settings)
    if writefile then
        writefile(fileName, HttpService:JSONEncode(settings))
    end
end

local function loadSettings(fileName)
    if readfile and isfile and isfile(fileName) then
        local success, result = pcall(function()
            return HttpService:JSONDecode(readfile(fileName))
        end)
        if success then return result end
    end
    return {}
end

-- Функция создания UI
function UILibrary.new(config)
    local ui = {}
    local settings = loadSettings(config.FileName or "eschaton_settings.json")
    local tabs = {}
    local currentTab = nil
    local uiVisible = true

    -- Создание основного ScreenGui
    local EschatonUI = Instance.new("ScreenGui")
    EschatonUI.Name = "EschatonUI"
    EschatonUI.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    EschatonUI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    EschatonUI.ResetOnSpawn = false

    -- MainFrame
    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Parent = EschatonUI
    MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    MainFrame.BorderColor3 = Color3.fromRGB(39, 39, 42)
    MainFrame.Position = UDim2.new(0.323854655, 0, 0.296717167, 0)
    MainFrame.Size = UDim2.new(0, 470, 0, 340)

    local UICorner_17 = Instance.new("UICorner")
    UICorner_17.Parent = MainFrame

    -- ElementContainer
    local ElementContainer = Instance.new("Frame")
    ElementContainer.Name = "ElementContainer"
    ElementContainer.Parent = EschatonUI
    ElementContainer.BackgroundColor3 = Color3.fromRGB(23, 23, 23)
    ElementContainer.BorderColor3 = Color3.fromRGB(255, 255, 255)
    ElementContainer.Position = UDim2.new(0.363327712, 0, 0.359848499, 0)
    ElementContainer.Size = UDim2.new(0, 420, 0, 290)
    ElementContainer.ZIndex = 2

    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 3)
    UICorner.Parent = ElementContainer

    -- Logo
    local Logo = Instance.new("ImageLabel")
    Logo.Name = "Logo"
    Logo.Parent = EschatonUI
    Logo.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    Logo.BackgroundTransparency = 0.900
    Logo.BorderColor3 = Color3.fromRGB(0, 0, 0)
    Logo.BorderSizePixel = 0
    Logo.Position = UDim2.new(0.330152452, 0, 0.306946725, 0)
    Logo.Size = UDim2.new(0, 32, 0, 32)
    Logo.ZIndex = 3
    Logo.Image = "rbxassetid://107336731168834"

    local UICorner_18 = Instance.new("UICorner")
    UICorner_18.Parent = Logo

    local Name = Instance.new("TextLabel")
    Name.Name = "Name"
    Name.Parent = Logo
    Name.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    Name.BackgroundTransparency = 1.000
    Name.BorderColor3 = Color3.fromRGB(0, 0, 0)
    Name.BorderSizePixel = 0
    Name.Position = UDim2.new(1.28125, 0, 0, 0)
    Name.Size = UDim2.new(0, 60, 0, 23)
    Name.Font = Enum.Font.SourceSansBold
    Name.Text = config.Name or "Eschaton"
    Name.TextColor3 = Color3.fromRGB(255, 255, 255)
    Name.TextSize = 18.000

    local Info = Instance.new("TextLabel")
    Info.Name = "Info"
    Info.Parent = Logo
    Info.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    Info.BackgroundTransparency = 1.000
    Info.BorderColor3 = Color3.fromRGB(0, 0, 0)
    Info.BorderSizePixel = 0
    Info.Position = UDim2.new(1.28125, 0, 0.59375, 0)
    Info.Size = UDim2.new(0, 60, 0, 6)
    Info.Font = Enum.Font.SourceSansBold
    Info.Text = config.Info or "War Tycoon"
    Info.TextColor3 = Color3.fromRGB(255, 255, 255)
    Info.TextSize = 10.000
    Info.TextXAlignment = Enum.TextXAlignment.Right

    local Version = Instance.new("TextLabel")
    Version.Name = "Version"
    Version.Parent = Logo
    Version.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    Version.BackgroundTransparency = 1.000
    Version.BorderColor3 = Color3.fromRGB(0, 0, 0)
    Version.BorderSizePixel = 0
    Version.Position = UDim2.new(3.26900005, 0, 0.344000012, 0)
    Version.Size = UDim2.new(0, 38, 0, 12)
    Version.Font = Enum.Font.SourceSansBold
    Version.Text = config.Version or "V1.0"
    Version.TextColor3 = Color3.fromRGB(255, 255, 255)
    Version.TextSize = 13.000
    Version.TextXAlignment = Enum.TextXAlignment.Left

    -- TabZone
    local TabZone = Instance.new("Frame")
    TabZone.Name = "TabZone"
    TabZone.Parent = EschatonUI
    TabZone.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    TabZone.BackgroundTransparency = 1.000
    TabZone.BorderColor3 = Color3.fromRGB(255, 255, 255)
    TabZone.Position = UDim2.new(0.323064923, 0, 0.359848499, 0)
    TabZone.Size = UDim2.new(0, 50, 0, 200)
    TabZone.ZIndex = 2

    -- Перетаскивание
    local dragging = false
    local dragStart = nil
    local startPos = nil
    
    MainFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position
        end
    end)
    
    MainFrame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement and dragging then
            local delta = input.Position - dragStart
            MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            -- Обновляем позиции всех элементов относительно MainFrame
            ElementContainer.Position = UDim2.new(startPos.X.Scale + 0.039473, startPos.X.Offset + delta.X + 17, startPos.Y.Scale + 0.063131, startPos.Y.Offset + delta.Y + 21)
            TabZone.Position = UDim2.new(startPos.X.Scale - 0.000789, startPos.X.Offset + delta.X - 0.34, startPos.Y.Scale + 0.063131, startPos.Y.Offset + delta.Y + 21)
            Logo.Position = UDim2.new(startPos.X.Scale + 0.006298, startPos.X.Offset + delta.X + 2.72, startPos.Y.Scale + 0.010229, startPos.Y.Offset + delta.Y + 3.4)
        end
    end)
    
    MainFrame.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)

    -- Скрытие/показ UI
    UserInputService.InputBegan:Connect(function(input, processed)
        if not processed and input.KeyCode == Enum.KeyCode.RightShift then
            uiVisible = not uiVisible
            EschatonUI.Enabled = uiVisible
        end
    end)

    -- Создание Settings таба по умолчанию
    local settingsTab = Instance.new("Frame")
    settingsTab.Name = "Settings"
    settingsTab.Parent = TabZone
    settingsTab.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    settingsTab.BackgroundTransparency = 1.000
    settingsTab.BorderColor3 = Color3.fromRGB(0, 0, 0)
    settingsTab.BorderSizePixel = 0
    settingsTab.Position = UDim2.new(0.0199999996, 0, 1.20000005, 0)
    settingsTab.Size = UDim2.new(0, 50, 0, 50)

    local settingsButton = Instance.new("TextButton")
    settingsButton.Name = "Tab3"
    settingsButton.Parent = settingsTab
    settingsButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    settingsButton.BackgroundTransparency = 1.000
    settingsButton.BorderColor3 = Color3.fromRGB(0, 0, 0)
    settingsButton.BorderSizePixel = 0
    settingsButton.Position = UDim2.new(0.159455568, 0, 0.144642949, 0)
    settingsButton.Size = UDim2.new(0, 35, 0, 35)
    settingsButton.Font = Enum.Font.SourceSans
    settingsButton.Text = ""
    settingsButton.TextColor3 = Color3.fromRGB(0, 0, 0)
    settingsButton.TextSize = 14.000

    local settingsCorner = Instance.new("UICorner")
    settingsCorner.Parent = settingsButton

    local settingsImage = Instance.new("ImageButton")
    settingsImage.Parent = settingsButton
    settingsImage.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    settingsImage.BackgroundTransparency = 1.000
    settingsImage.BorderColor3 = Color3.fromRGB(0, 0, 0)
    settingsImage.BorderSizePixel = 0
    settingsImage.Position = UDim2.new(0.232244879, 0, 0.231250003, 0)
    settingsImage.Size = UDim2.new(0, 18, 0, 18)
    settingsImage.ZIndex = 3
    settingsImage.Image = "rbxassetid://7059346373"

    -- Создание Tab
    function ui:CreateTab(name, imageId)
        local tab = {}
        local tabIndex = #tabs + 1
        
        -- ZoneTab
        local ZoneTab = Instance.new("Frame")
        ZoneTab.Name = "ZoneTab" .. tabIndex
        ZoneTab.Parent = TabZone
        ZoneTab.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        ZoneTab.BackgroundTransparency = 1.000
        ZoneTab.BorderColor3 = Color3.fromRGB(0, 0, 0)
        ZoneTab.BorderSizePixel = 0
        ZoneTab.Position = UDim2.new(0.0199999996, 0, (tabIndex - 1) * 0.25, 0)
        ZoneTab.Size = UDim2.new(0, 50, 0, 50)

        local TabButton = Instance.new("TextButton")
        TabButton.Name = "Tab" .. tabIndex
        TabButton.Parent = ZoneTab
        TabButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        TabButton.BackgroundTransparency = tabIndex == 1 and 0.950 or 1.000
        TabButton.BorderColor3 = Color3.fromRGB(0, 0, 0)
        TabButton.BorderSizePixel = 0
        TabButton.Position = UDim2.new(0.159455568, 0, 0.135535896, 0)
        TabButton.Size = UDim2.new(0, 35, 0, 35)
        TabButton.Font = Enum.Font.SourceSans
        TabButton.Text = ""
        TabButton.TextColor3 = Color3.fromRGB(0, 0, 0)
        TabButton.TextSize = 14.000

        local UICorner_19 = Instance.new("UICorner")
        UICorner_19.Parent = TabButton

        local ImageButton = Instance.new("ImageButton")
        ImageButton.Parent = TabButton
        ImageButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        ImageButton.BackgroundTransparency = 1.000
        ImageButton.BorderColor3 = Color3.fromRGB(0, 0, 0)
        ImageButton.BorderSizePixel = 0
        ImageButton.Position = UDim2.new(0.232244879, 0, 0.231250003, 0)
        ImageButton.Size = UDim2.new(0, 18, 0, 18)
        ImageButton.ZIndex = 3
        ImageButton.Image = imageId or "rbxassetid://9940330045"
        ImageButton.ImageColor3 = tabIndex == 1 and Color3.fromRGB(1, 128, 203) or Color3.fromRGB(255, 255, 255)

        local Line = Instance.new("Frame")
        Line.Name = "Line"
        Line.Parent = TabButton
        Line.BackgroundColor3 = tabIndex == 1 and Color3.fromRGB(1, 128, 203) or Color3.fromRGB(255, 255, 255)
        Line.BorderColor3 = Color3.fromRGB(0, 0, 0)
        Line.BorderSizePixel = 0
        Line.Position = UDim2.new(1.74386162e-06, 0, 0.114285715, 0)
        Line.Size = UDim2.new(0, 2, 0, 27)
        Line.Visible = tabIndex == 1

        local UICorner_20 = Instance.new("UICorner")
        UICorner_20.CornerRadius = UDim.new(1, 0)
        UICorner_20.Parent = Line

        -- Контейнер для секций
        local tabContainer = Instance.new("Frame")
        tabContainer.Name = name .. "Container"
        tabContainer.Parent = ElementContainer
        tabContainer.BackgroundTransparency = 1
        tabContainer.Size = UDim2.new(1, 0, 1, 0)
        tabContainer.Visible = tabIndex == 1

        tabs[tabIndex] = {
            button = TabButton,
            image = ImageButton,
            line = Line,
            container = tabContainer,
            name = name
        }

        -- Обработка клика по табу
        TabButton.MouseButton1Click:Connect(function()
            for i, t in pairs(tabs) do
                t.button.BackgroundTransparency = 1.000
                t.image.ImageColor3 = Color3.fromRGB(255, 255, 255)
                t.line.Visible = false
                t.container.Visible = false
            end
            TabButton.BackgroundTransparency = 0.950
            ImageButton.ImageColor3 = Color3.fromRGB(1, 128, 203)
            Line.Visible = true
            tabContainer.Visible = true
            currentTab = name
        end)
        
        -- Обработка наведения мыши
        TabButton.MouseEnter:Connect(function()
            if currentTab ~= name then
                TabButton.BackgroundTransparency = 0.980
                ImageButton.ImageColor3 = Color3.fromRGB(255, 255, 255)
            end
        end)
        
        TabButton.MouseLeave:Connect(function()
            if currentTab ~= name then
                TabButton.BackgroundTransparency = 1.000
                ImageButton.ImageColor3 = Color3.fromRGB(255, 255, 255)
            end
        end)

        -- Создание Section
        function tab:CreateSection(name)
            local section = {}
            local sectionCount = 0
            for _, child in pairs(tabContainer:GetChildren()) do
                if child:IsA("Frame") and child.Name:find("Section") then
                    sectionCount = sectionCount + 1
                end
            end

            local isLeft = sectionCount % 2 == 0
            local sectionFrame = Instance.new("Frame")
            sectionFrame.Name = name
            sectionFrame.Parent = tabContainer
            sectionFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
            sectionFrame.BorderColor3 = Color3.fromRGB(0, 0, 0)
            sectionFrame.BorderSizePixel = 0
            sectionFrame.Position = isLeft and UDim2.new(0.0238095243, 0, 0.0344827585 + math.floor(sectionCount / 2) * 0.45, 0) or UDim2.new(0.511904776, 0, 0.0344827585 + math.floor(sectionCount / 2) * 0.45, 0)
            sectionFrame.Size = UDim2.new(0, 195, 0, 120)

            local UICorner_2 = Instance.new("UICorner")
            UICorner_2.Parent = sectionFrame

            local SectionName = Instance.new("TextLabel")
            SectionName.Name = "SectionName"
            SectionName.Parent = sectionFrame
            SectionName.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            SectionName.BackgroundTransparency = 1.000
            SectionName.BorderColor3 = Color3.fromRGB(0, 0, 0)
            SectionName.BorderSizePixel = 0
            SectionName.Position = UDim2.new(0.0350961536, 0, 0.00633911137, 0)
            SectionName.Size = UDim2.new(0, 18, 0, 16)
            SectionName.Font = Enum.Font.SourceSansBold
            SectionName.Text = name
            SectionName.TextColor3 = Color3.fromRGB(255, 255, 255)
            SectionName.TextSize = 12.000
            SectionName.TextXAlignment = Enum.TextXAlignment.Left

            local elementY = 0.25

            -- Функция обновления размера секции
            local function updateSectionSize()
                sectionFrame.Size = UDim2.new(0, 195, 0, math.max(120, elementY * 120 + 30))
            end

            -- CreateToggle
            function section:CreateToggle(name, default, callback, saveId)
                local saveKey = saveId or name
                local currentValue = settings[saveKey] ~= nil and settings[saveKey] or default

                local ToggleZone = Instance.new("Frame")
                ToggleZone.Name = "ToggleZone"
                ToggleZone.Parent = sectionFrame
                ToggleZone.Active = true
                ToggleZone.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                ToggleZone.BackgroundTransparency = 1.000
                ToggleZone.BorderColor3 = Color3.fromRGB(0, 0, 0)
                ToggleZone.BorderSizePixel = 0
                ToggleZone.Position = UDim2.new(0, 0, elementY, 0)
                ToggleZone.Size = UDim2.new(0, 195, 0, 30)

                -- Option кнопка (справа)
                local Option = Instance.new("ImageButton")
                Option.Name = "Option"
                Option.Parent = ToggleZone
                Option.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                Option.BackgroundTransparency = 1.000
                Option.BorderColor3 = Color3.fromRGB(0, 0, 0)
                Option.BorderSizePixel = 0
                Option.Position = UDim2.new(0.925128341, 0, 0.291727692, 0)
                Option.Rotation = 90.000
                Option.Size = UDim2.new(0, 14, 0, 13)
                Option.Image = "rbxassetid://136882854117051"

                local Turner = Instance.new("TextButton")
                Turner.Name = "Turner"
                Turner.Parent = ToggleZone
                Turner.BackgroundColor3 = Color3.fromRGB(23, 23, 23)
                Turner.BorderColor3 = Color3.fromRGB(0, 0, 0)
                Turner.BorderSizePixel = 0
                Turner.Position = UDim2.new(0.738461554, 0, 0.333333343, 0)
                Turner.Size = UDim2.new(0, 30, 0, 10)
                Turner.Font = Enum.Font.SourceSans
                Turner.Text = ""
                Turner.TextColor3 = Color3.fromRGB(0, 0, 0)
                Turner.TextSize = 14.000

                local UICorner_4 = Instance.new("UICorner")
                UICorner_4.Parent = Turner

                local TextButton_2 = Instance.new("TextButton")
                TextButton_2.Parent = Turner
                TextButton_2.BackgroundColor3 = currentValue and Color3.fromRGB(1, 128, 203) or Color3.fromRGB(89, 89, 89)
                TextButton_2.BorderColor3 = Color3.fromRGB(0, 0, 0)
                TextButton_2.BorderSizePixel = 0
                TextButton_2.Position = currentValue and UDim2.new(0.566666663, 0, -0.200000003, 0) or UDim2.new(0, 0, -0.200000003, 0)
                TextButton_2.Size = UDim2.new(0, 13, 0, 13)
                TextButton_2.Font = Enum.Font.SourceSans
                TextButton_2.Text = ""
                TextButton_2.TextColor3 = Color3.fromRGB(0, 0, 0)
                TextButton_2.TextSize = 1.000

                local UICorner_5 = Instance.new("UICorner")
                UICorner_5.CornerRadius = UDim.new(1, 0)
                UICorner_5.Parent = TextButton_2

                local ToggleName = Instance.new("TextLabel")
                ToggleName.Name = "ToggleName"
                ToggleName.Parent = ToggleZone
                ToggleName.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                ToggleName.BackgroundTransparency = 1.000
                ToggleName.BorderColor3 = Color3.fromRGB(0, 0, 0)
                ToggleName.BorderSizePixel = 0
                ToggleName.Position = UDim2.new(0.0516529568, 0, 0.233005777, 0)
                ToggleName.Size = UDim2.new(0, 18, 0, 16)
                ToggleName.Font = Enum.Font.SourceSansBold
                ToggleName.Text = name
                ToggleName.TextColor3 = Color3.fromRGB(255, 255, 255)
                ToggleName.TextSize = 13.000
                ToggleName.TextXAlignment = Enum.TextXAlignment.Left

                local function toggleFunction()
                    currentValue = not currentValue
                    settings[saveKey] = currentValue
                    saveSettings(config.FileName or "eschaton_settings.json", settings)
                    TextButton_2.BackgroundColor3 = currentValue and Color3.fromRGB(1, 128, 203) or Color3.fromRGB(89, 89, 89)
                    TextButton_2.Position = currentValue and UDim2.new(0.566666663, 0, -0.200000003, 0) or UDim2.new(0, 0, -0.200000003, 0)
                    if callback then callback(currentValue) end
                end

                Turner.MouseButton1Click:Connect(toggleFunction)
                TextButton_2.MouseButton1Click:Connect(toggleFunction)

                -- Option клик (откроет окошко настроек)
                Option.MouseButton1Click:Connect(function()
                    print("Options for", name, "- Save:", saveId ~= nil)
                    -- Здесь будет окошко настроек
                end)

                if currentValue and callback then
                    spawn(function() callback(currentValue) end)
                end

                elementY = elementY + 0.25
                updateSectionSize()
            end

            -- CreateButton
            function section:CreateButton(name, callback)
                local ButtonZone = Instance.new("Frame")
                ButtonZone.Name = "ButtonZone"
                ButtonZone.Parent = sectionFrame
                ButtonZone.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                ButtonZone.BackgroundTransparency = 1.000
                ButtonZone.BorderColor3 = Color3.fromRGB(0, 0, 0)
                ButtonZone.BorderSizePixel = 0
                ButtonZone.Position = UDim2.new(0, 0, elementY, 0)
                ButtonZone.Size = UDim2.new(0, 195, 0, 30)

                local TextButton = Instance.new("TextButton")
                TextButton.Parent = ButtonZone
                TextButton.BackgroundColor3 = Color3.fromRGB(23, 23, 23)
                TextButton.BorderColor3 = Color3.fromRGB(0, 0, 0)
                TextButton.BorderSizePixel = 0
                TextButton.Position = UDim2.new(0.0504807681, 0, 0.0735626221, 0)
                TextButton.Size = UDim2.new(0, 175, 0, 25)
                TextButton.Font = Enum.Font.SourceSans
                TextButton.Text = ""
                TextButton.TextColor3 = Color3.fromRGB(0, 0, 0)
                TextButton.TextSize = 12.000

                local UICorner_3 = Instance.new("UICorner")
                UICorner_3.Parent = TextButton

                local ButtonName = Instance.new("TextLabel")
                ButtonName.Name = "ButtonName"
                ButtonName.Parent = TextButton
                ButtonName.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                ButtonName.BackgroundTransparency = 1.000
                ButtonName.BorderColor3 = Color3.fromRGB(0, 0, 0)
                ButtonName.BorderSizePixel = 0
                ButtonName.Position = UDim2.new(0.0465248339, 0, 0.166339114, 0)
                ButtonName.Size = UDim2.new(0, 18, 0, 16)
                ButtonName.Font = Enum.Font.SourceSansBold
                ButtonName.Text = name
                ButtonName.TextColor3 = Color3.fromRGB(255, 255, 255)
                ButtonName.TextSize = 13.000
                ButtonName.TextXAlignment = Enum.TextXAlignment.Left

                local btn = Instance.new("TextLabel")
                btn.Name = "btn"
                btn.Parent = TextButton
                btn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                btn.BackgroundTransparency = 1.000
                btn.BorderColor3 = Color3.fromRGB(0, 0, 0)
                btn.BorderSizePixel = 0
                btn.Position = UDim2.new(0.766524851, 0, 0.191724852, 0)
                btn.Size = UDim2.new(0, 31, 0, 14)
                btn.Font = Enum.Font.SourceSansBold
                btn.Text = "button"
                btn.TextColor3 = Color3.fromRGB(104, 104, 104)
                btn.TextSize = 11.000
                btn.TextXAlignment = Enum.TextXAlignment.Left

                TextButton.MouseButton1Click:Connect(function()
                    if callback then callback() end
                end)

                elementY = elementY + 0.25
                updateSectionSize()
            end

            return section
        end

        return tab
    end

    return ui
end

-- Глобальные функции
function CreateToggle(config)
    return config.section:CreateToggle(config.name or "Toggle", config.default or false, config.callback, config.save and (config.id or config.name) or nil)
end

function CreateButton(config)
    return config.section:CreateButton(config.name or "Button", config.callback)
end

_G.CreateToggle = CreateToggle
_G.CreateButton = CreateButton

return UILibrary
